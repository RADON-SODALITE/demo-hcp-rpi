---
tosca_definitions_version: tosca_simple_yaml_1_3

imports:
  - radon/_definitions/radonnodesrpi__RPiMinIOBucketNotification.tosca
  - radon/_definitions/radonnodesrpi__RPiMinIOBuckets.tosca
  - radon/_definitions/radonnodesrpi__RPiOpenFaaSFunction.tosca

topology_template:
  inputs:
    master_node_ip:
      type: string
    rpi_username:
      type: string
    rpi_password:
      type: string
    minio_user:
      type: string
    minio_password:
      type: string
    bucket_in_name:
      type: string
    bucket_out_name:
      type: string
    resize_image_name:
      type: string
    resize_function_name:
      type: string

  node_templates:
    my-workstation:
      type: tosca.nodes.Compute
      attributes:
        private_address: { get_input: master_node_ip }
        public_address: { get_input: master_node_ip }

    bucket_create:
      type: radon.nodes.rpi.RPiMinIOBuckets
      properties:
        bucket_in_name: { get_input: bucket_in_name }
        bucket_out_name: { get_input: bucket_out_name }
        minio_ip: { get_input: master_node_ip }
        minio_user: { get_input: minio_user }
        minio_password: { get_input: minio_password }
      requirements:
        - host: my-workstation

    function_deploy:
      type: radon.nodes.rpi.RPiOpenFaaSFunction
      properties:
        resize_image_name: { get_input: resize_image_name }
        resize_function_name: { get_input: resize_function_name }
        node_ip: { get_input: master_node_ip }
      requirements:
        - host: my-workstation

    bucket_notification:
      type: radon.nodes.rpi.RPiMinIOBucketNotification
      properties:
        node_ip: { get_input: master_node_ip }
        minio_user: { get_input: minio_user }
        minio_password: { get_input: minio_password }
        function_name: { get_input: resize_function_name }
        bucket_in_name: { get_input: bucket_in_name }
      requirements:
        - host: my-workstation
...